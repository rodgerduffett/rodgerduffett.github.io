<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Password Reset</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<h2>Resetting your password...</h2>
<div id="message"></div>

<script>
    // 1. Initialize Supabase client
    const supabaseUrl = "https://jfhiyeyfjaqemfdftwif.supabase.co";
    const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmaGl5ZXlmamFxZW1mZGZ0d2lmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NDg0NDIsImV4cCI6MjA2OTEyNDQ0Mn0.Qf6Ah0GxuCW_kOnWhDVac9zIOpxy_pOd3dMdKDuk9gk";  // replace with your anon key
    const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

    // 2. Handle the recovery link
    async function handleRecovery() {
      const hashParams = new URLSearchParams(window.location.hash.substring(1));
      const accessToken = hashParams.get("access_token");
      const refreshToken = hashParams.get("refresh_token");

      if (accessToken && refreshToken) {
        // Exchange tokens and set session
        const { data, error } = await supabase.auth.setSession({
          access_token: accessToken,
          refresh_token: refreshToken,
        });

        if (error) {
          document.getElementById("message").textContent = "Error: " + error.message;
        } else {
          document.getElementById("message").textContent =
            "Session restored! You can now reset your password.";
          // redirect to your app or show a reset form here
        }
      } else {
        document.getElementById("message").textContent =
          "Invalid recovery link. Missing tokens.";
      }
    }

    handleRecovery();
</script>
</body>
</html>

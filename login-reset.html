<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Password Reset</title>
    <!-- Load Supabase v2 from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<h2>Password Reset</h2>
<div id="message"></div>

<script>
    // 1. Initialize Supabase client
    const SUPABASE_URL = "https://jfhiyeyfjaqemfdftwif.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmaGl5ZXlmamFxZW1mZGZ0d2lmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NDg0NDIsImV4cCI6MjA2OTEyNDQ0Mn0.Qf6Ah0GxuCW_kOnWhDVac9zIOpxy_pOd3dMdKDuk9gk"; // replace with your anon key

    const { createClient } = supabase;   // <- global comes from the script include
    const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 2. Handle recovery link (tokens come in URL fragment after #)
    async function handleRecovery() {
      const hashParams = new URLSearchParams(window.location.hash.substring(1));
      const accessToken = hashParams.get("access_token");
      const refreshToken = hashParams.get("refresh_token");

      if (accessToken && refreshToken) {
        const { data, error } = await client.auth.setSession({
          access_token: accessToken,
          refresh_token: refreshToken,
        });

        if (error) {
          document.getElementById("message").textContent =
            "Error: " + error.message;
        } else {
          document.getElementById("message").textContent =
            "Session restored! You can now reset your password.";
          // TODO: add form for entering new password
        }
      } else {
        document.getElementById("message").textContent =
          "Invalid recovery link or missing tokens.";
      }
    }

    handleRecovery();
</script>
</body>
</html>

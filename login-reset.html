<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
<h2>Reset Your Password</h2>
<form id="reset-form" style="display:none;">
    <label>
        New password:
        <input type="password" id="new-password" required />
    </label>
    <button type="submit">Update Password</button>
</form>
<p id="status"></p>

<script>
    const SUPABASE_URL = "https://jfhiyeyfjaqemfdftwif.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function init() {
      // ðŸ‘‡ Exchange PKCE code from URL for a valid session
      const { data, error } = await supabase.auth.exchangeCodeForSession(window.location.href);

      if (error) {
        document.getElementById("status").textContent = "Error: " + error.message;
        return;
      }

      if (data?.session) {
        // Now user is authenticated for password recovery
        document.getElementById("status").textContent = "Enter a new password below:";
        document.getElementById("reset-form").style.display = "block";
      }
    }

    init();

    document.getElementById("reset-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const newPassword = document.getElementById("new-password").value;

      const { error } = await supabase.auth.updateUser({
        password: newPassword,
      });

      if (error) {
        document.getElementById("status").textContent = "Error: " + error.message;
      } else {
        document.getElementById("status").textContent = "âœ… Password updated. You can now log in with your new password.";
        document.getElementById("reset-form").style.display = "none";
      }
    });
</script>
</body>
</html>
